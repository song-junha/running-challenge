<!DOCTYPE html>
<html lang="ko" data-theme="bumblebee">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>러닝 기록 비교</title>
  <link href="output.css" rel="stylesheet" type="text/css" />
</head>
<body class="bg-base-200" style="padding-bottom: 56px;">
  <div class="container mx-auto px-3 py-3 max-w-7xl" id="mainContent">
    <!-- 홈 페이지 -->
    <div id="homePage" class="page-content">
      <!-- Header -->
      <div class="card bg-base-100 shadow-md mb-4 border border-base-300">
        <div class="card-body p-4">
          <h1 class="card-title text-2xl font-bold text-base-content">🏃‍♂️ 러닝 챌린지</h1>

          <div class="flex flex-wrap gap-2 mt-3">
            <div class="btn-group">
              <button class="btn btn-xs btn-active" data-period="thisMonth">이번달</button>
              <button class="btn btn-xs" data-period="lastMonth">저번달</button>
              <button class="btn btn-xs" data-period="thisYear">올해</button>
              <button class="btn btn-xs" data-period="lastYear">작년</button>
            </div>

            <button id="stravaConnect" class="btn btn-warning btn-xs gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"/>
              </svg>
              연동
            </button>

            <button id="stravaSync" class="btn btn-success btn-xs gap-1 hidden">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
              동기화
            </button>
          </div>
        </div>
      </div>

      <!-- Stats Grid -->
      <div id="stats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4">
        <div class="flex justify-center items-center col-span-full">
          <span class="loading loading-spinner loading-lg text-primary"></span>
        </div>
      </div>
    </div>

    <!-- 활동 페이지 -->
    <div id="activityPage" class="page-content hidden">
      <div class="card bg-base-100 shadow-md mb-4 border border-base-300">
        <div class="card-body p-4">
          <h1 class="card-title text-2xl font-bold text-base-content">🔥 최근 활동</h1>
        </div>
      </div>

      <div id="activities" class="space-y-2">
        <div class="flex justify-center py-8">
          <span class="loading loading-dots loading-lg text-primary"></span>
        </div>
      </div>
    </div>

    <!-- 대회 페이지 -->
    <div id="competitionPage" class="page-content hidden">
      <!-- 고정 헤더 -->
      <div style="position: sticky; top: 0; z-index: 10; background: #f5f5f5; padding-bottom: 12px;">
        <!-- 헤더 및 버튼 -->
        <div class="card bg-base-100 shadow-md mb-3 border border-base-300">
          <div class="card-body p-4">
            <div class="flex justify-between items-center">
              <h1 class="card-title text-2xl font-bold text-base-content">🏆 대회</h1>
              <div class="flex gap-2">
                <button class="btn btn-primary btn-xs" onclick="openCompetitionModal('create')">등록</button>
                <button class="btn btn-secondary btn-xs" onclick="openCompetitionModal('edit')">수정</button>
                <button class="btn btn-error btn-xs" onclick="deleteCompetition()">삭제</button>
              </div>
            </div>
          </div>
        </div>

        <!-- 필터 버튼 및 검색 -->
        <div class="flex flex-col gap-2 px-1">
          <div class="flex gap-2">
            <button class="btn btn-sm btn-active" data-filter="future" onclick="filterCompetitions('future')">예정된 대회</button>
            <button class="btn btn-sm" data-filter="past" onclick="filterCompetitions('past')">지난 대회</button>
          </div>
          <div class="flex items-center gap-2">
            <h3 id="competitionFilterTitle" class="text-sm font-semibold text-primary whitespace-nowrap">🔜 예정된 대회</h3>
            <input
              type="text"
              id="competitionSearch"
              placeholder="대회명 또는 참가자 검색"
              class="input input-sm input-bordered flex-1"
              oninput="searchCompetitions(this.value)"
            />
          </div>
        </div>
      </div>

      <!-- 대회 리스트 -->
      <div id="competitionList" class="space-y-3">
        <!-- 로딩 상태 -->
        <div class="flex justify-center py-8">
          <span class="loading loading-dots loading-lg text-primary"></span>
        </div>
      </div>
    </div>

    <!-- 등록 페이지 -->
    <div id="registerPage" class="page-content hidden">
      <!-- 헤더 및 버튼 -->
      <div class="card bg-base-100 shadow-md mb-4 border border-base-300">
        <div class="card-body p-4">
          <div class="flex justify-between items-center mb-3">
            <h1 class="card-title text-2xl font-bold text-base-content">📝 사용자 관리</h1>
            <div class="flex gap-2">
              <button class="btn btn-warning btn-xs gap-1" onclick="window.location.href='/auth/strava'">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"/>
                </svg>
                연동
              </button>
              <button class="btn btn-secondary btn-xs" onclick="openUserModal('edit')">수정</button>
              <button class="btn btn-error btn-xs" onclick="deleteUser()">삭제</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 사용자 리스트 -->
      <div id="userList" class="space-y-2">
        <!-- 로딩 상태 -->
        <div class="flex justify-center py-8">
          <span class="loading loading-dots loading-lg text-primary"></span>
        </div>
      </div>
    </div>

    <!-- 맞짱 챌린지 페이지 -->
    <div id="challengePage" class="page-content hidden">
      <div class="card bg-base-100 shadow-md mb-4 border border-base-300">
        <div class="card-body p-4">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="card-title text-2xl font-bold text-base-content">🥊 스시101 맞짱</h1>
              <p class="text-xs text-base-content/50 mb-1" id="currentUserName">접속 중...</p>
              <p class="text-sm text-base-content/70">참여기간: 2025.11.07 ~ 2025.12.13</p>
            </div>
            <div id="challengeDDay" class="text-right">
              <p class="text-3xl font-bold text-error"></p>
            </div>
          </div>
          <div class="flex gap-2 mt-3">
            <button id="joinChallengeBtn" class="btn btn-primary btn-sm" onclick="openJoinModal()">참여</button>
            <button id="connectStravaBtn" class="btn btn-warning btn-sm gap-1" onclick="window.location.href='/auth/strava'">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"/>
              </svg>
              연결하기
            </button>
            <button id="giftBtn" class="btn btn-error btn-sm gap-1 hidden" onclick="openGiftModal()">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
              </svg>
              선물하기
            </button>
            <button id="syncChallengeBtn" class="btn btn-success btn-sm gap-1" onclick="syncChallengeActivities()">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
              동기화
            </button>
          </div>
        </div>
      </div>

      <!-- 참가자 리스트 -->
      <div id="challengeParticipants" class="space-y-3">
        <div class="flex justify-center py-8">
          <span class="loading loading-dots loading-lg text-primary"></span>
        </div>
      </div>
    </div>

    <!-- 관리 페이지 -->
    <div id="adminPage" class="page-content hidden">
      <div class="card bg-base-100 shadow-md border border-base-300">
        <div class="card-body p-4">
          <h1 class="card-title text-2xl font-bold text-base-content">⚙️ 관리</h1>
          <p class="text-sm text-base-content/70 mb-3">관리자 페이지로 이동합니다</p>

          <div class="flex flex-col items-center justify-center py-12">
            <a href="/admin.html" class="btn btn-primary btn-md gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              관리자 페이지로 이동
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 하단 네비게이션 -->
  <div style="
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    border-top: 1px solid #e5e5e5;
    display: flex;
    justify-content: space-around;
    padding: 6px 0 8px 0;
    z-index: 1000;
  ">
    <button class="nav-item active" data-page="homePage" style="
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 12px;
      transition: opacity 0.2s;
      opacity: 1;
    ">
      <span style="font-size: 20px;">🏠</span>
      <span style="font-size: 9px; color: #666;">홈</span>
    </button>
    <button class="nav-item" data-page="activityPage" style="
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 12px;
      transition: opacity 0.2s;
      opacity: 0.5;
    ">
      <span style="font-size: 20px;">🔥</span>
      <span style="font-size: 9px; color: #666;">활동</span>
    </button>
    <button class="nav-item" data-page="competitionPage" style="
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 12px;
      transition: opacity 0.2s;
      opacity: 0.5;
    ">
      <span style="font-size: 20px;">🏆</span>
      <span style="font-size: 9px; color: #666;">대회</span>
    </button>
    <button class="nav-item" data-page="registerPage" style="
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 12px;
      transition: opacity 0.2s;
      opacity: 0.5;
    ">
      <span style="font-size: 20px;">📝</span>
      <span style="font-size: 9px; color: #666;">등록</span>
    </button>
    <button class="nav-item" data-page="challengePage" style="
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 12px;
      transition: opacity 0.2s;
      opacity: 0.5;
    ">
      <span style="font-size: 20px;">🥊</span>
      <span style="font-size: 9px; color: #666;">맞짱</span>
    </button>
    <button class="nav-item" data-page="adminPage" style="
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1px;
      background: none;
      border: none;
      cursor: not-allowed;
      padding: 4px 12px;
      transition: opacity 0.2s;
      opacity: 0.3;
      pointer-events: none;
    ">
      <span style="font-size: 20px;">⚙️</span>
      <span style="font-size: 9px; color: #666;">관리</span>
    </button>
  </div>

  <!-- 대회 등록/수정 모달 -->
  <dialog id="competitionModal" class="modal">
    <div class="modal-box max-w-md">
      <form method="dialog">
        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
      </form>
      <h3 class="font-bold text-xl mb-6" id="competitionModalTitle">대회 등록</h3>

      <div class="space-y-4">
        <!-- 날짜 -->
        <div>
          <label class="block text-sm font-semibold mb-2">날짜 *</label>
          <input type="date" id="compDate" class="hidden" required onchange="updateDateDisplay()" />
          <div
            onclick="document.getElementById('compDate').showPicker()"
            class="input input-bordered w-full cursor-pointer flex items-center"
            style="height: 44px; font-size: 15px;"
          >
            <span id="dateDisplay" class="text-base-content/50">날짜를 선택하세요</span>
          </div>
        </div>

        <!-- 대회명 -->
        <div>
          <label class="block text-sm font-semibold mb-2">대회명 *</label>
          <input
            type="text"
            id="compName"
            class="input input-bordered w-full"
            style="height: 44px; font-size: 15px;"
            placeholder="가을 러닝 챌린지"
            required
          />
        </div>

        <!-- 참가자 목록 (관리자 전용) -->
        <div id="participantsSection">
          <label class="block text-sm font-semibold mb-2">참가자 (선택사항)</label>
          <div id="participantsList" class="space-y-2 max-h-48 overflow-y-auto mb-3"></div>
          <button type="button" class="btn btn-outline w-full" onclick="addParticipantInput()">
            + 참가자 추가
          </button>
        </div>

        <!-- 저장 버튼 -->
        <div class="flex gap-2 pt-4">
          <button type="button" class="btn btn-primary flex-1" onclick="saveCompetition()">저장</button>
          <button type="button" class="btn btn-ghost flex-1" onclick="closeCompetitionModal()">취소</button>
        </div>
      </div>
    </div>
  </dialog>

  <!-- 활동 상세 모달 -->
  <dialog id="activityDetailModal" class="modal">
    <div class="modal-box max-w-4xl">
      <form method="dialog">
        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
      </form>
      <h3 class="font-bold text-2xl mb-1" id="activityDetailTitle">활동 상세</h3>
      <p class="text-sm text-base-content/60 mb-4" id="activityDetailDate"></p>
      <div id="activityDetailContent" class="space-y-4">
        <div class="flex justify-center py-8">
          <span class="loading loading-spinner loading-lg text-primary"></span>
        </div>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>

  <!-- Personal Records Modal -->
  <dialog id="recordsModal" class="modal">
    <div class="modal-box max-w-2xl">
      <form method="dialog">
        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
      </form>
      <h3 class="font-bold text-2xl mb-4" id="modalUserName">개인 기록</h3>
      <div id="recordsContent" class="space-y-3">
        <div class="flex justify-center py-8">
          <span class="loading loading-spinner loading-lg text-primary"></span>
        </div>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>

  <!-- 맞짱 참가 모달 -->
  <dialog id="joinChallengeModal" class="modal">
    <div class="modal-box max-w-md">
      <form method="dialog">
        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
      </form>
      <h3 class="font-bold text-xl mb-6">맞짱 참가</h3>

      <div class="space-y-4">
        <!-- 사용자 이름 표시 (일반 사용자) -->
        <div id="userNameDisplay">
          <label class="block text-sm font-semibold mb-2">참가자</label>
          <div class="input input-bordered w-full bg-base-200" style="height: 44px; font-size: 15px; display: flex; align-items: center;">
            <span id="joinUserName">-</span>
          </div>
        </div>

        <!-- 사용자 선택 드롭다운 (관리자) -->
        <div id="userSelectContainer" class="hidden">
          <label class="block text-sm font-semibold mb-2">참가자 선택 *</label>
          <select
            id="userSelect"
            class="select select-bordered w-full"
            style="height: 44px; font-size: 15px;"
          >
            <option value="">사용자를 선택하세요</option>
          </select>
        </div>

        <!-- 목표 거리 입력 -->
        <div>
          <label class="block text-sm font-semibold mb-2">목표 거리 (km) *</label>
          <input
            type="number"
            id="targetDistance"
            class="input input-bordered w-full"
            style="height: 44px; font-size: 15px;"
            placeholder="100"
            min="1"
            step="0.1"
            required
          />
        </div>

        <!-- 저장 버튼 -->
        <div class="flex gap-2 pt-4">
          <button type="button" class="btn btn-primary flex-1" onclick="saveJoinChallenge()">참가 확정</button>
          <button type="button" class="btn btn-ghost flex-1" onclick="closeJoinModal()">취소</button>
        </div>
      </div>
    </div>
  </dialog>

  <!-- 선물하기 모달 -->
  <dialog id="giftModal" class="modal">
    <div class="modal-box max-w-2xl">
      <form method="dialog">
        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
      </form>
      <h3 class="font-bold text-xl mb-6">🎁 목표거리 선물하기</h3>

      <!-- 일반 사용자용 -->
      <div id="normalGiftContent" class="space-y-4 hidden">
        <div class="alert alert-info">
          <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span>하루에 한 번만 선물할 수 있습니다. 자신의 목표거리를 다른 참가자에게 전달하세요!</span>
        </div>

        <!-- 받는 사람 선택 -->
        <div>
          <label class="block text-sm font-semibold mb-2">선물받을 사람 *</label>
          <select id="giftRecipient" class="select select-bordered w-full" style="height: 44px; font-size: 15px;">
            <option value="">선택하세요</option>
          </select>
        </div>

        <!-- 선물할 거리 -->
        <div>
          <label class="block text-sm font-semibold mb-2">선물할 거리 (km) *</label>
          <input
            type="number"
            id="giftDistance"
            class="input input-bordered w-full"
            style="height: 44px; font-size: 15px;"
            placeholder="10"
            min="1"
            max="50"
            step="0.1"
            required
          />
          <p class="text-xs text-base-content/60 mt-1">내 목표거리에서 차감되고, 선택한 사람의 목표거리에 추가됩니다.</p>
        </div>

        <!-- 저장 버튼 -->
        <div class="flex gap-2 pt-4">
          <button type="button" class="btn btn-error flex-1" onclick="saveGift()">선물하기</button>
          <button type="button" class="btn btn-ghost flex-1" onclick="closeGiftModal()">취소</button>
        </div>
      </div>

      <!-- 관리자용 (송준하) -->
      <div id="adminGiftContent" class="space-y-4 hidden">
        <div class="alert alert-warning">
          <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
          <span>관리자 모드: 모든 참가자의 목표거리를 조정할 수 있습니다.</span>
        </div>

        <div id="adminGiftList" class="space-y-3 max-h-96 overflow-y-auto">
          <!-- 동적으로 생성됨 -->
        </div>

        <!-- 저장 버튼 -->
        <div class="flex gap-2 pt-4">
          <button type="button" class="btn btn-error flex-1" onclick="saveAdminGift()">일괄 적용</button>
          <button type="button" class="btn btn-ghost flex-1" onclick="closeGiftModal()">취소</button>
        </div>
      </div>
    </div>
  </dialog>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
